{% extends "courses/course_base.html" %}

{% block course_breadcrumbs %}
  <nav aria-label="breadcrumb" class="mb-3">
    <ol class="breadcrumb mb-0">
      <li class="breadcrumb-item">
        <a href="{% url 'dashboard' %}">Home</a>
      </li>
      <li class="breadcrumb-item">
        <a href="{% url 'course_detail' course.id %}">Modules</a>
      </li>
      <li class="breadcrumb-item active" aria-current="page">
        {{ assignment.title }}
      </li>
    </ol>
  </nav>
{% endblock %}

{% block course_content %}
  <div class="d-flex justify-content-between align-items-start mb-3">
    <div>
      <h1 class="h4 mb-1">{{ assignment.title }}</h1>
      <p class="text-muted mb-0">
        Points: {{ assignment.points_possible }}
        {% if assignment.due_at %}Â· Due: {{ assignment.due_at }}{% endif %}
      </p>
    </div>
    <div class="d-flex gap-2">
      {% if is_teacher %}
        <a
          class="btn btn-primary btn-lg"
          href="{% url 'submission_list' assignment.id %}"
        >
          ì±„ì í•˜ê¸° (SpeedGrader)
        </a>
      {% else %}
        <a href="#ê³¼ì œì œì¶œì˜ì—­" class="btn btn-primary btn-lg">
          ê³¼ì œ ì œì¶œ
        </a>
      {% endif %}
    </div>
  </div>

  <article class="card mb-4">
    <div class="card-body">
      <div class="assignment-body">
        {{ assignment.description|safe }}
      </div>
    </div>
  </article>

  <!-- ê³¼ì œ ì œì¶œ ì˜ì—­ (í•œêµ­ ê²Œì‹œíŒ ìŠ¤íƒ€ì¼ - í•­ìƒ ë…¸ì¶œ) -->
  {% if not is_teacher %}
  <div id="ê³¼ì œì œì¶œì˜ì—­" class="card mb-4 border-primary">
    <div class="card-header bg-light">
      <h2 class="h5 mb-0">ê³¼ì œ ì œì¶œ</h2>
    </div>
    <div class="card-body">
      <form
        method="post"
        enctype="multipart/form-data"
        action="{% url 'submit_assignment' assignment.id %}"
      >
        {% csrf_token %}

        <div class="mb-3">
          <label for="id_body" class="form-label">í…ìŠ¤íŠ¸ ì…ë ¥</label>
          <textarea
            id="id_body"
            name="body"
            rows="4"
            class="form-control"
            placeholder="ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”..."
          ></textarea>
        </div>

        <div class="mb-3">
          <label for="id_url" class="form-label">URL</label>
          <input
            type="url"
            id="id_url"
            name="url"
            class="form-control"
            placeholder="https://example.com"
          />
        </div>

        <div class="mb-3">
          <label for="id_attachment" class="form-label">íŒŒì¼ ì²¨ë¶€</label>
          <input
            type="file"
            id="id_attachment"
            name="attachment"
            class="form-control"
          />
        </div>

        <button type="submit" class="btn btn-primary btn-lg">
          ê³¼ì œ ì œì¶œ
        </button>
      </form>
    </div>
  </div>
  {% endif %}

  <div class="d-flex justify-content-between mt-4">
    {% if prev_item_url %}
      <a class="btn btn-outline-secondary btn-sm" href="{{ prev_item_url }}">
        &laquo; Previous
      </a>
    {% else %}
      <span></span>
    {% endif %}

    {% if next_item_url %}
      <a class="btn btn-primary btn-sm" href="{{ next_item_url }}">
        Next &raquo;
      </a>
    {% endif %}
  </div>
{% endblock %}

{% block course_sidebar %}
  <div class="mb-4">
    <h6 class="text-uppercase text-muted small mb-2">Submission Details</h6>
    {% if latest_submission %}
      <ul class="list-group list-group-flush small">
        <li class="list-group-item px-0">
 <!-- Status í‘œì‹œ -->
<div style="margin-bottom: 10px;">
 <!-- ìµœì¢… ìˆ˜ì •ëœ ì‚¬ì´ë“œë°” ì½”ë“œ -->
<div class="submission-details">
    
  <!-- 1. ìƒíƒœ (Status) -->
  <div style="margin-bottom: 15px;">
      <strong>Status:</strong>
      <!-- |title í•„í„°ë¥¼ ì¨ì„œ í™”ë©´ì—” 'Graded'ë¡œ ì˜ˆì˜ê²Œ ë³´ì—¬ì¤Œ -->
      <span class="status-label">{{ latest_submission.workflow_state|title }}</span>
  </div>

  <!-- 2. ì ìˆ˜ (Grade) -->
  <!-- ìˆ˜ì • í¬ì¸íŠ¸: 'graded' (ì†Œë¬¸ì)ë¡œ í™•ì¸! -->
  {% if latest_submission.workflow_state == 'graded' %}
      <div style="margin-bottom: 15px; border-top: 1px solid #ccc; padding-top: 10px;">
          <strong style="display: block; margin-bottom: 5px;">Grade:</strong>
          <span style="font-size: 2em; font-weight: bold; color: #2D3B45;">
              {{ latest_submission.score }}
          </span>
          <span style="color: #666; font-size: 1.2em;"> / {{ assignment.points_possible }}</span>
      </div>
  {% endif %}

  <!-- 3. ì œì¶œ ì‹œê°„ -->
  <div style="font-size: 0.9em; color: #555;">
      <strong>Submitted at:</strong><br>
      {{ latest_submission.submitted_at|date:"M d, Y, g:i a" }}
  </div>

</div>
        </li>
        <li class="list-group-item px-0">
          <strong>Submitted at:</strong>
          {{ latest_submission.submitted_at }}
        </li>
        {% if latest_submission.body %}
          <li class="list-group-item px-0">
            <strong>Text:</strong>
            <div class="mt-1 text-muted">
              {{ latest_submission.body|truncatechars:120 }}
            </div>
          </li>
        {% endif %}
        {% if latest_submission.url %}
          <li class="list-group-item px-0">
            <strong>URL:</strong>
            <a href="{{ latest_submission.url }}" target="_blank">
              {{ latest_submission.url }}
            </a>
          </li>
        {% endif %}
        {% if latest_submission.attachment %}
          <li class="list-group-item px-0">
            <strong>File:</strong>
            <a href="{{ latest_submission.attachment.url }}" target="_blank">
              {{ latest_submission.attachment.name }}
            </a>
          </li>
        {% endif %}
      </ul>
    {% else %}
      <p class="small text-muted mb-0">
        No submissions yet.
      </p>
    {% endif %}
    <!-- í”¼ë“œë°±(Feedback) í‘œì‹œ ì½”ë“œ ì‹œì‘ -->
{% if latest_submission.feedback %}
<div style="margin-top: 20px; border-top: 1px solid #ccc; padding-top: 10px;">
    <h4 style="margin: 0 0 10px 0; font-size: 1.1em; color: #2D3B45;">
        <i class="fas fa-comment"></i> Feedback
    </h4>
    <div style="background-color: #e8f4f8; padding: 10px; border-radius: 5px; font-size: 0.95em; color: #333;">
        {{ latest_submission.feedback|linebreaks }}
    </div>
</div>
{% endif %}
<!-- í”¼ë“œë°±(Feedback) í‘œì‹œ ì½”ë“œ ë -->
 <!-- Feedback ê°•ì œ ì¶œë ¥ (ë””ë²„ê¹…ìš©) -->
<div style="margin-top: 15px; border-top: 1px dashed #ccc; padding-top: 10px;">
  <h4 style="margin: 0 0 5px 0; font-size: 1.1em; color: #2D3B45;">Feedback Check:</h4>
  
  <!-- 1. latest_submission ë³€ìˆ˜ë¡œ ì‹œë„ -->
  <p><strong>Method A:</strong> {{ latest_submission.feedback }}</p>
  
  <!-- 2. submission ë³€ìˆ˜ë¡œ ì‹œë„ (í˜¹ì‹œ ë³€ìˆ˜ëª…ì´ ë‹¤ë¥¼ê¹Œë´) -->
  <p><strong>Method B:</strong> {{ submission.feedback }}</p>
</div>
  </div>

  <div class="mb-4">
    <h6 class="text-uppercase text-muted small mb-2">Coming Up</h6>
    <ul class="list-group list-group-flush small">
      <li class="list-group-item px-0">
        <span class="text-muted">No upcoming events</span>
      </li>
    </ul>
  </div>

  <div class="d-grid">
    <button class="btn btn-outline-secondary btn-sm" type="button">
      View Course Stream
    </button>
  </div>

  {% if request.GET.submitted %}
    <script>
      // Simple confetti-like effect using emojis
      document.addEventListener("DOMContentLoaded", function () {
        const emojis = ["ğŸ‰", "âœ¨", "ğŸŠ"];
        const container = document.body;
        for (let i = 0; i < 40; i++) {
          const span = document.createElement("span");
          span.textContent = emojis[Math.floor(Math.random() * emojis.length)];
          span.style.position = "fixed";
          span.style.left = Math.random() * 100 + "vw";
          span.style.top = "-10px";
          span.style.fontSize = "1.5rem";
          span.style.animation = "fall 2s linear infinite";
          span.style.animationDelay = Math.random() * 2 + "s";
          container.appendChild(span);
        }
      });

      const style = document.createElement("style");
      style.textContent = `
        @keyframes fall {
          0% { transform: translateY(0); opacity: 1; }
          100% { transform: translateY(110vh); opacity: 0; }
        }
      `;
      document.head.appendChild(style);
    </script>
  {% endif %}
{% endblock %}

